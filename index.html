<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#060507" />
  <title>Proyecto CoolDown</title>
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="icon" type="image/svg+xml" href="assets/icon.svg" />
  <link rel="apple-touch-icon" href="assets/icon-maskable.svg" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css"
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />
  <link id="mainStylesheet" rel="stylesheet" href="" />
  <script>
    window.APP_VERSION = 'v13';
    window.APP_VERSION_LABEL = window.APP_VERSION;
    window.DEFAULT_PORTRAIT = 'assets/empty.png';
    const stylesheet = document.getElementById('mainStylesheet');
    if (stylesheet) {
      stylesheet.href = `styles.css?v=${window.APP_VERSION}`;
    }
  </script>
</head>
<body>
  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display: none">
    <symbol id="icon-user" viewBox="0 0 24 24">
      <circle cx="12" cy="7" r="4" fill="currentColor" />
      <path
        d="M5 20.5C5 16.1 8.58 13 12 13s7 3.1 7 7.5v1.5H5z"
        fill="currentColor"
      />
    </symbol>
    <symbol id="icon-user-plus" viewBox="0 0 24 24">
      <circle cx="9" cy="8" r="3.8" fill="currentColor" />
      <path d="M3 20.5C3 15.8 6.58 12 11 12s8 3.8 8 8.5v1.5H3z" fill="currentColor" />
      <path d="M18 4h2v2h2v2h-2v2h-2V8h-2V6h2z" fill="currentColor" />
    </symbol>
    <symbol id="icon-chevron-up" viewBox="0 0 24 24">
      <path d="M6.4 15.1 12 9.5l5.6 5.6-1.4 1.4L12 12.3l-4.2 4.2z" fill="currentColor" />
    </symbol>
    <symbol id="icon-chevron-down" viewBox="0 0 24 24">
      <path d="M6.4 8.9 12 14.5l5.6-5.6 1.4 1.4L12 17.7 5 10.3z" fill="currentColor" />
    </symbol>
    <symbol id="icon-heart" viewBox="0 0 24 24">
      <path
        d="M12 21s-6.4-4.9-8.2-8C2 9.9 3 6.2 6 4.9a4.5 4.5 0 0 1 6 2 4.5 4.5 0 0 1 6-2C21 6.2 22 9.9 20.2 13c-1.8 3.1-8.2 8-8.2 8z"
        fill="currentColor"
      />
    </symbol>
    <symbol id="icon-crosshairs" viewBox="0 0 24 24">
      <circle cx="12" cy="12" r="4" fill="none" stroke="currentColor" stroke-width="2" />
      <path d="M12 3v3m0 15v-3M3 12h3m15 0h-3" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
    </symbol>
    <symbol id="icon-shield" viewBox="0 0 24 24">
      <path
        d="M12 2.5 4.5 5.7v6c0 4.8 3.4 9.5 7.5 10.8 4.1-1.3 7.5-6 7.5-10.8v-6z"
        fill="currentColor"
      />
    </symbol>
    <symbol id="icon-burst" viewBox="0 0 24 24">
      <path
        d="M12 3.5 14.1 8l4.9-.3-3.7 3.3 1.1 4.7-4.4-2.4-4.4 2.4 1.1-4.7-3.7-3.3 4.9.3z"
        fill="currentColor"
      />
    </symbol>
    <symbol id="icon-movement" viewBox="0 0 24 24">
      <path
        d="M5 18.5 10.5 9l-3-.8 1-2.7 6.5 2a2 2 0 0 1 1.2 1.1l1 2.3 2.3 1-1 2.6-2.6-1.1-1.5 2.4 3.1 1.5-1.3 2.4-4.8-2.4-2.8 4.5z"
        fill="currentColor"
      />
    </symbol>
    <symbol id="icon-eye-range" viewBox="0 0 24 24">
      <path
        d="M12 6.5c5 0 8.6 3.8 9.9 5.5-1.3 1.7-4.9 5.5-9.9 5.5s-8.6-3.8-9.9-5.5C3.4 10.3 7 6.5 12 6.5z"
        fill="none"
        stroke="currentColor"
        stroke-width="1.8"
      />
      <circle cx="12" cy="12" r="2.6" fill="currentColor" />
      <path d="M4 5 2.5 3.5 5.5 2l1 2.8z" fill="currentColor" />
      <path d="M4.7 5.7 11 9" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
    </symbol>
    <symbol id="icon-arrow-left" viewBox="0 0 24 24">
      <path d="m10.4 5.6-6.8 6.4 6.8 6.4 1.6-1.7-3.9-3.7H21v-2.9H8.1l3.9-3.7z" fill="currentColor" />
    </symbol>
    <symbol id="icon-toolbox" viewBox="0 0 24 24">
      <path d="M7 6V4h10v2h4v12H3V6z" fill="currentColor" opacity="0.85" />
      <rect x="5" y="9" width="14" height="7" rx="1" ry="1" fill="currentColor" />
      <path d="M10 6V5h4v1z" fill="#060507" opacity="0.45" />
    </symbol>
    <symbol id="icon-hand-sparkles" viewBox="0 0 24 24">
      <path
        d="M7 12.5V9.2a1.2 1.2 0 1 1 2.4 0v2.2l.1-3a1.2 1.2 0 1 1 2.4 0V12l.2-3.3a1.2 1.2 0 1 1 2.4.2V12l.3-2.3a1.2 1.2 0 1 1 2.4.4L17 16.5a4.5 4.5 0 0 1-4.4 3.7H8a3 3 0 0 1-3-3v-1.4a2.3 2.3 0 0 1 2-2.3z"
        fill="currentColor"
      />
      <path d="M6 4.5 5.2 3l1.6-.7.7-1.6.8 1.6 1.5.7-1.5.8-.7 1.5z" fill="currentColor" />
      <path d="M17.5 5.5 16.9 4l1.4-.6.6-1.4.6 1.4 1.4.6-1.4.6-.6 1.4z" fill="currentColor" />
    </symbol>
    <symbol id="icon-gear" viewBox="0 0 24 24">
      <path
        d="m10.4 2.5 3.2 0 1 3 2.8 1.1 2.7-1.6 1.6 2.7-2 2.3.3 2.9 2.6 1-1.1 3.1-2.9-.2-1.8 2.2-2.8-1.1-2.8 1.1-1.8-2.2-2.9.2-1.1-3.1 2.6-1-.3-2.9-2-2.3 1.6-2.7 2.7 1.6 2.8-1.1z"
        fill="currentColor"
        opacity="0.95"
      />
      <circle cx="12" cy="12" r="3" fill="#060507" opacity="0.35" />
      <circle cx="12" cy="12" r="1.8" fill="currentColor" />
    </symbol>
    <symbol id="icon-xmark" viewBox="0 0 24 24">
      <path d="m6 6 12 12m0-12-12 12" stroke="currentColor" stroke-width="2.4" stroke-linecap="round" />
    </symbol>
    <symbol id="icon-upload" viewBox="0 0 24 24">
      <path d="M5 19h14v2H5z" fill="currentColor" />
      <path d="M12 4.5 7.5 9h3v6h4V9h3z" fill="currentColor" />
    </symbol>
    <symbol id="icon-eraser" viewBox="0 0 24 24">
      <path d="M3 16 11.5 6h4L21 11l-6.5 7H8z" fill="currentColor" />
      <path d="M8 17h9v2H8z" fill="#060507" opacity="0.4" />
    </symbol>
    <symbol id="icon-pen-to-square" viewBox="0 0 24 24">
      <path
        d="M5 4h9l-2 2H7v12h10v-5l2-2v9H5z"
        fill="currentColor"
      />
      <path d="m20.7 5.3-1-1a1 1 0 0 0-1.4 0l-5.1 5.1V13h3.6l5-5a1 1 0 0 0 0-1.4z" fill="currentColor" />
    </symbol>
    <symbol id="icon-trash" viewBox="0 0 24 24">
      <path d="M9 4h6l1 2h5v2H4V6h5z" fill="currentColor" />
      <path d="M6 8h12l-.8 11.2A2 2 0 0 1 15.2 21H8.8a2 2 0 0 1-2-1.8z" fill="currentColor" />
      <path d="M10 11h1v7h-1zm3 0h1v7h-1z" fill="#060507" opacity="0.4" />
    </symbol>
    <symbol id="icon-download" viewBox="0 0 24 24">
      <path d="M5 18h14v2H5z" fill="currentColor" />
      <path d="m12 4-4 4h3v7h2V8h3z" fill="currentColor" />
    </symbol>
    <symbol id="icon-upload" viewBox="0 0 24 24">
      <path d="M5 18h14v2H5z" fill="currentColor" />
      <path d="m12 4 4 4h-3v6h-2V8H8z" fill="currentColor" />
    </symbol>
  </svg>
  <div id="app" class="app">
    <header class="app-header hidden">
      <div class="app-brand">
        <i class="fa-solid fa-dice-d20 fa-spin" aria-hidden="true"></i>
        <span class="app-title">Proyecto CoolDown</span>
      </div>
      <span class="app-version" data-app-version></span>
    </header>
    <div class="character-select" data-screen="select">
      <header class="select-header">
        <h1>Selecciona tu Personaje</h1>
        <div class="select-actions">
          <button class="btn create-btn" id="createCharacterBtn">
            <svg class="icon icon-user-plus" aria-hidden="true" focusable="false">
              <use href="#icon-user-plus" xlink:href="#icon-user-plus"></use>
            </svg>
            Crear PJ
          </button>
          <button class="btn secondary import-btn" type="button" id="importCharacterBtn">
            <svg class="icon icon-upload" aria-hidden="true" focusable="false">
              <use href="#icon-upload" xlink:href="#icon-upload"></use>
            </svg>
            Importar PJ
          </button>
          <input
            type="file"
            id="importCharacterInput"
            accept="application/json,.json,.charsheet,.char"
            hidden
          />
        </div>
      </header>
      <section class="character-list" id="characterList">
        <!-- Character cards inserted by JS -->
      </section>
    </div>

    <div class="character-sheet hidden" data-screen="sheet">
      <section class="hero-card">
        <div class="hero-background"></div>
        <img data-default-portrait alt="Retrato del personaje" class="hero-portrait" />
        <div class="hero-overlay"></div>
        <div class="hero-info">
          <h2 id="heroName" class="hero-name">Nombre del PJ</h2>
          <p id="heroDetails" class="hero-details">Humano · Bardo · Nivel 3</p>
          <p id="heroAffiliation" class="hero-affiliation hidden">Grupo · Campaña</p>
        </div>
        <button
          type="button"
          class="hero-toggle"
          id="heroToggle"
          aria-label="Minimizar cabecera del personaje"
          aria-expanded="true"
        >
          <svg class="icon icon-chevron-up" aria-hidden="true" focusable="false">
            <use href="#icon-chevron-up" xlink:href="#icon-chevron-up"></use>
          </svg>
        </button>
      </section>

      <section class="stats-panel">
        <div class="stat" data-stat="vida">
          <span class="stat-icon">
            <svg class="icon icon-heart" aria-hidden="true" focusable="false">
              <use href="#icon-heart" xlink:href="#icon-heart"></use>
            </svg>
          </span>
          <div class="stat-content">
            <span class="stat-label">VIDA</span>
            <span class="stat-value">0</span>
            <div class="stat-modifiers" data-stat-modifiers="vida"></div>
          </div>
        </div>
        <div class="stat" data-stat="ataque">
          <span class="stat-icon">
            <svg class="icon icon-crosshairs" aria-hidden="true" focusable="false">
              <use href="#icon-crosshairs" xlink:href="#icon-crosshairs"></use>
            </svg>
          </span>
          <div class="stat-content">
            <span class="stat-label">ATQ</span>
            <span class="stat-value">0</span>
            <div class="stat-modifiers" data-stat-modifiers="ataque"></div>
          </div>
        </div>
        <div class="stat" data-stat="defensa">
          <span class="stat-icon">
            <svg class="icon icon-shield" aria-hidden="true" focusable="false">
              <use href="#icon-shield" xlink:href="#icon-shield"></use>
            </svg>
          </span>
          <div class="stat-content">
            <span class="stat-label">DEF</span>
            <span class="stat-value">0</span>
            <div class="stat-modifiers" data-stat-modifiers="defensa"></div>
          </div>
        </div>
        <div class="stat" data-stat="danio">
          <span class="stat-icon">
            <svg class="icon icon-burst" aria-hidden="true" focusable="false">
              <use href="#icon-burst" xlink:href="#icon-burst"></use>
            </svg>
          </span>
          <div class="stat-content">
            <span class="stat-label">DAÑO</span>
            <span class="stat-value">0</span>
            <div class="stat-modifiers" data-stat-modifiers="danio"></div>
          </div>
        </div>
        <div class="stat" data-stat="movimiento">
          <span class="stat-icon">
            <i class="fa-solid fa-shoe-prints" aria-hidden="true"></i>
          </span>
          <div class="stat-content">
            <span class="stat-label">MOV</span>
            <span class="stat-value">0</span>
            <div class="stat-modifiers" data-stat-modifiers="movimiento"></div>
          </div>
        </div>
        <div class="stat" data-stat="alcance">
          <span class="stat-icon">
            <i class="fa-solid fa-bullseye" aria-hidden="true"></i>
          </span>
          <div class="stat-content">
            <span class="stat-label">ALC</span>
            <span class="stat-value">0</span>
            <div class="stat-modifiers" data-stat-modifiers="alcance"></div>
          </div>
        </div>
      </section>
      <section class="sheet-abilities" id="sheetActiveAbilities">
        <header class="sheet-abilities-header">
          <h3>Habilidades activas</h3>
          <p class="sheet-abilities-subtitle">Seleccioná una habilidad para ver sus detalles.</p>
        </header>
        <div class="sheet-ability-list" id="sheetActiveAbilityList" aria-live="polite"></div>
      </section>
    </div>
    <div class="inventory-screen hidden" data-screen="inventory">
      <div class="inventory-header">
        <button type="button" class="btn primary" id="addInventoryItem">Agregar nuevo item</button>
      </div>
      <div class="inventory-list" id="inventoryList" aria-live="polite"></div>
    </div>
    <div class="abilities-screen hidden" data-screen="abilities">
      <div class="abilities-header">
        <button type="button" class="btn primary" id="addActiveAbility">Agregar habilidad activa</button>
        <button type="button" class="btn secondary" id="addPassiveAbility">Agregar habilidad pasiva</button>
      </div>
      <div class="ability-columns">
        <section class="ability-column">
          <header class="ability-column-header">
            <h3>Habilidades activas</h3>
          </header>
          <div class="ability-list" id="activeAbilityList" aria-live="polite"></div>
        </section>
        <section class="ability-column">
          <header class="ability-column-header">
            <h3>Habilidades pasivas</h3>
          </header>
          <div class="ability-list" id="passiveAbilityList" aria-live="polite"></div>
        </section>
      </div>
    </div>
    <div class="notes-screen hidden" data-screen="notes">
      <div class="notes-container">
        <label class="form-field stacked notes-field" for="notesTextarea">
          Notas
          <textarea id="notesTextarea" rows="12" placeholder="Escribí tus notas"></textarea>
        </label>
        <div class="notes-actions">
          <button type="button" class="btn primary" id="saveNotesButton">Guardar</button>
        </div>
      </div>
    </div>
    <div class="settings-screen hidden" data-screen="settings">
      <div class="settings-content">
        <button type="button" class="btn secondary settings-back" id="settingsBackButton">
          <svg class="icon icon-arrow-left" aria-hidden="true" focusable="false">
            <use href="#icon-arrow-left" xlink:href="#icon-arrow-left"></use>
          </svg>
          Volver
        </button>
        <div class="settings-info">
          <p>Proyecto CoolDown.</p>
          <p>Prototipo de app realizada por Mateo Foulkes</p>
          <p>(con alguito de chatgpt)</p>
          <p>2025</p>
        </div>
      </div>
    </div>
    <nav class="bottom-bar" aria-label="Menú principal">
      <button type="button" class="nav-button" data-action="back" aria-label="Volver">
        <i class="fa-solid fa-table-list" aria-hidden="true"></i>
        <span class="sr-only">Volver</span>
      </button>
      <button type="button" class="nav-button" data-action="sheet" aria-label="Hoja de personaje">
        <svg class="icon icon-user" aria-hidden="true" focusable="false">
          <use href="#icon-user" xlink:href="#icon-user"></use>
        </svg>
        <span class="sr-only">Hoja de personaje</span>
      </button>
      <button type="button" class="nav-button" data-action="inventory" aria-label="Inventario">
        <svg class="icon icon-toolbox" aria-hidden="true" focusable="false">
          <use href="#icon-toolbox" xlink:href="#icon-toolbox"></use>
        </svg>
        <span class="sr-only">Inventario</span>
      </button>
      <button type="button" class="nav-button" data-action="abilities" aria-label="Habilidades y hechizos">
        <svg class="icon icon-hand-sparkles" aria-hidden="true" focusable="false">
          <use href="#icon-hand-sparkles" xlink:href="#icon-hand-sparkles"></use>
        </svg>
        <span class="sr-only">Habilidades y hechizos</span>
      </button>
      <button type="button" class="nav-button" data-action="notes" aria-label="Notas">
        <i class="fa-solid fa-feather-pointed" aria-hidden="true"></i>
        <span class="sr-only">Notas</span>
      </button>
      <button type="button" class="nav-button" data-action="settings" aria-label="Opciones">
        <i class="fa-solid fa-circle-info" aria-hidden="true"></i>
        <span class="sr-only">Opciones</span>
      </button>
    </nav>
  </div>

  <div id="characterEditor" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="editorTitle">
    <div class="modal-backdrop" id="editorBackdrop"></div>
    <div class="modal-dialog">
      <header class="modal-header">
        <h2 id="editorTitle">Editor de personaje</h2>
        <button type="button" class="icon-button close" id="closeEditor" aria-label="Cerrar editor">
          <svg class="icon icon-xmark" aria-hidden="true" focusable="false">
            <use href="#icon-xmark" xlink:href="#icon-xmark"></use>
          </svg>
        </button>
      </header>
      <form id="characterForm" class="character-form" autocomplete="off">
        <section class="form-section">
          <h3>Datos generales</h3>
          <div class="form-grid two-col">
            <label class="form-field stacked">
              Nombre
              <input id="characterName" name="characterName" type="text" required />
            </label>
            <label class="form-field stacked">
              Nivel
              <input id="characterLevel" name="characterLevel" type="number" min="1" value="1" />
            </label>
            <label class="form-field stacked">
              Raza / Ancestría
              <input id="characterAncestry" name="characterAncestry" type="text" />
            </label>
            <label class="form-field stacked">
              Clase
              <input id="characterClass" name="characterClass" type="text" />
            </label>
            <label class="form-field stacked">
              Grupo
              <input id="characterGroup" name="characterGroup" type="text" />
            </label>
            <label class="form-field stacked">
              Campaña / Compañía
              <input id="characterCampaign" name="characterCampaign" type="text" />
            </label>
          </div>
        </section>

        <section class="form-section">
          <h3>Retrato</h3>
          <div class="portrait-field">
            <img id="portraitPreview" data-default-portrait alt="Retrato del personaje" />
            <div class="portrait-actions">
              <label class="btn primary file-btn">
                <svg class="icon icon-upload" aria-hidden="true" focusable="false">
                  <use href="#icon-upload" xlink:href="#icon-upload"></use>
                </svg>
                Subir PNG
                <input id="portraitInput" type="file" accept="image/png" hidden />
              </label>
              <button type="button" class="btn secondary" id="clearPortrait">
                <svg class="icon icon-eraser" aria-hidden="true" focusable="false">
                  <use href="#icon-eraser" xlink:href="#icon-eraser"></use>
                </svg>
                Quitar
              </button>
            </div>
          </div>
        </section>

        <section class="form-section">
          <h3>Estadísticas</h3>
          <div class="stats-form-grid">
            <div class="stat-input" data-stat="vida">
              <h4>Vida</h4>
              <label class="form-field stacked">
                Valor
                <input id="stat-vida" name="stat-vida" type="text" />
              </label>
            </div>
            <div class="stat-input" data-stat="ataque">
              <h4>Ataque</h4>
              <label class="form-field stacked">
                Valor
                <input id="stat-ataque" name="stat-ataque" type="text" />
              </label>
            </div>
            <div class="stat-input" data-stat="defensa">
              <h4>Defensa</h4>
              <label class="form-field stacked">
                Valor
                <input id="stat-defensa" name="stat-defensa" type="text" />
              </label>
            </div>
            <div class="stat-input" data-stat="danio">
              <h4>Daño</h4>
              <label class="form-field stacked">
                Valor
                <input id="stat-danio" name="stat-danio" type="text" />
              </label>
            </div>
            <div class="stat-input" data-stat="movimiento">
              <h4>Movimiento</h4>
              <label class="form-field stacked">
                Valor
                <input id="stat-movimiento" name="stat-movimiento" type="text" />
              </label>
            </div>
            <div class="stat-input" data-stat="alcance">
              <h4>Alcance</h4>
              <label class="form-field stacked">
                Valor
                <input id="stat-alcance" name="stat-alcance" type="text" />
              </label>
            </div>
          </div>
        </section>
        <footer class="form-actions">
          <button type="button" class="btn secondary" id="cancelEditor">Cancelar</button>
          <button type="submit" class="btn primary">Guardar</button>
        </footer>
      </form>
    </div>
  </div>

  <div
    id="statDetailModal"
    class="modal hidden"
    role="dialog"
    aria-modal="true"
    aria-labelledby="statDetailTitle"
  >
    <div class="modal-backdrop" data-close-modal="stat"></div>
    <div class="modal-dialog stat-modal">
      <header class="modal-header">
        <h2 id="statDetailTitle">Detalle de estadística</h2>
        <button type="button" class="icon-button close" id="closeStatDetail" aria-label="Cerrar">
          <svg class="icon icon-xmark" aria-hidden="true" focusable="false">
            <use href="#icon-xmark" xlink:href="#icon-xmark"></use>
          </svg>
        </button>
      </header>
      <div class="stat-modal-content">
        <p class="stat-modal-intro" id="statDetailIntro"></p>
        <ul class="stat-modifier-list" id="statModifierList" aria-live="polite"></ul>
        <div class="health-controls hidden" id="healthControlSection">
          <h3>Puntos de vida</h3>
          <div class="health-display" id="healthDisplay"></div>
          <div class="health-input-row">
            <button
              type="button"
              class="btn tertiary"
              id="healthDecrement"
              aria-label="Restar un punto de vida"
            >
              <i class="fa-solid fa-minus" aria-hidden="true"></i>
            </button>
            <input
              id="healthCurrentInput"
              type="number"
              min="0"
              step="1"
              inputmode="numeric"
              aria-label="Puntos de vida actuales"
            />
            <button
              type="button"
              class="btn tertiary"
              id="healthIncrement"
              aria-label="Sumar un punto de vida"
            >
              <i class="fa-solid fa-plus" aria-hidden="true"></i>
            </button>
          </div>
          <p class="health-max-label">
            Vida total: <span id="healthMaxValue">0</span>
          </p>
        </div>
      </div>
      <footer class="form-actions stat-modal-actions">
        <button type="button" class="btn secondary" id="cancelStatDetail">Cancelar</button>
        <button type="button" class="btn primary" id="saveStatDetail">Guardar</button>
      </footer>
    </div>
  </div>

  <div
    id="sheetAbilityModal"
    class="modal hidden"
    role="dialog"
    aria-modal="true"
    aria-labelledby="sheetAbilityTitle"
  >
    <div class="modal-backdrop" data-close-modal="sheet-ability"></div>
    <div class="modal-dialog ability-detail-modal">
      <header class="modal-header">
        <h2 id="sheetAbilityTitle">Detalle de habilidad</h2>
        <button type="button" class="icon-button close" id="closeSheetAbilityModal" aria-label="Cerrar">
          <svg class="icon icon-xmark" aria-hidden="true" focusable="false">
            <use href="#icon-xmark" xlink:href="#icon-xmark"></use>
          </svg>
        </button>
      </header>
      <div class="ability-detail-content">
        <div class="ability-detail-media">
          <img id="sheetAbilityImage" alt="Ilustración de la habilidad" />
        </div>
        <div class="ability-detail-info">
          <p id="sheetAbilityDescription" class="ability-detail-description empty">Sin descripción disponible.</p>
          <ul id="sheetAbilityFeatureList" class="ability-detail-features"></ul>
        </div>
      </div>
      <div class="ability-detail-cooldown" id="sheetAbilityCooldown"></div>
      <p id="sheetAbilityQuestion" class="ability-detail-question">¿Desea ejecutar esta habilidad?</p>
      <footer class="form-actions ability-detail-actions">
        <button type="button" class="btn secondary" id="cancelAbilityExecution">Cancelar</button>
        <button type="button" class="btn tertiary hidden" id="resetAbilityCooldown">Resetear cooldown</button>
        <button type="button" class="btn primary" id="confirmAbilityExecution">Ejecutar habilidad</button>
      </footer>
    </div>
  </div>

  <div
    id="activeAbilityModal"
    class="modal hidden"
    role="dialog"
    aria-modal="true"
    aria-labelledby="activeAbilityModalTitle"
  >
    <div class="modal-backdrop" data-close-modal="active"></div>
    <div class="modal-dialog ability-modal">
      <header class="modal-header">
        <h2 id="activeAbilityModalTitle">Nueva habilidad activa</h2>
        <button type="button" class="icon-button close" id="closeActiveAbility" aria-label="Cerrar">
          <svg class="icon icon-xmark" aria-hidden="true" focusable="false">
            <use href="#icon-xmark" xlink:href="#icon-xmark"></use>
          </svg>
        </button>
      </header>
      <form id="activeAbilityForm" class="ability-form" autocomplete="off">
        <div class="form-grid one-col">
          <label class="form-field stacked">
            Título
            <input id="activeAbilityTitle" name="title" type="text" required />
          </label>
          <label class="form-field stacked">
            Descripción
            <textarea id="activeAbilityDescription" name="description" rows="3"></textarea>
          </label>
          <label class="form-field stacked">
            Características (una por línea)
            <textarea id="activeAbilityFeatures" name="features" rows="4"></textarea>
          </label>
          <label class="form-field stacked">
            Turnos de cooldown
            <input id="activeAbilityCooldown" name="cooldown" type="number" min="0" value="0" />
          </label>
          <label class="form-field stacked">
            Duración del efecto (turnos)
            <input id="activeAbilityDuration" name="effectDuration" type="number" min="0" value="0" />
          </label>
        </div>
        <div class="ability-image-field">
          <img id="activeAbilityPreview" alt="Vista previa de la habilidad" />
          <div class="ability-image-actions">
            <label class="btn primary file-btn">
              <svg class="icon icon-upload" aria-hidden="true" focusable="false">
                <use href="#icon-upload" xlink:href="#icon-upload"></use>
              </svg>
              Subir PNG
              <input id="activeAbilityImage" type="file" accept="image/png" hidden />
            </label>
            <button type="button" class="btn secondary" id="clearActiveAbilityImage">Quitar imagen</button>
          </div>
        </div>
        <footer class="form-actions">
          <button type="button" class="btn secondary" id="cancelActiveAbility">Cancelar</button>
          <button type="submit" class="btn primary">Guardar</button>
        </footer>
      </form>
    </div>
  </div>

  <div
    id="passiveAbilityModal"
    class="modal hidden"
    role="dialog"
    aria-modal="true"
    aria-labelledby="passiveAbilityModalTitle"
  >
    <div class="modal-backdrop" data-close-modal="passive"></div>
    <div class="modal-dialog ability-modal">
      <header class="modal-header">
        <h2 id="passiveAbilityModalTitle">Nueva habilidad pasiva</h2>
        <button type="button" class="icon-button close" id="closePassiveAbility" aria-label="Cerrar">
          <svg class="icon icon-xmark" aria-hidden="true" focusable="false">
            <use href="#icon-xmark" xlink:href="#icon-xmark"></use>
          </svg>
        </button>
      </header>
      <form id="passiveAbilityForm" class="ability-form" autocomplete="off">
        <div class="form-grid one-col">
          <label class="form-field stacked">
            Título
            <input id="passiveAbilityTitle" name="title" type="text" required />
          </label>
          <label class="form-field stacked">
            Descripción
            <textarea id="passiveAbilityDescription" name="description" rows="3"></textarea>
          </label>
          <label class="form-field stacked">
            Características (una por línea)
            <textarea id="passiveAbilityFeatures" name="features" rows="4"></textarea>
          </label>
          <label class="form-field stacked">
            Turnos de cooldown
            <input id="passiveAbilityCooldown" name="cooldown" type="number" min="0" value="0" />
          </label>
          <label class="form-field stacked">
            Duración del efecto (turnos)
            <input id="passiveAbilityDuration" name="effectDuration" type="number" min="0" value="0" />
          </label>
        </div>
        <section class="modifier-section">
          <div class="modifier-header">
            <h3>Modificadores</h3>
            <button type="button" class="btn tertiary" id="addPassiveModifier">
              <i class="fa-solid fa-plus" aria-hidden="true"></i>
              <span>Agregar modificador</span>
            </button>
          </div>
          <div class="modifier-list" id="passiveModifierList" aria-live="polite"></div>
        </section>
        <footer class="form-actions">
          <button type="button" class="btn secondary" id="cancelPassiveAbility">Cancelar</button>
          <button type="submit" class="btn primary">Guardar</button>
        </footer>
      </form>
    </div>
  </div>

  <div
    id="inventoryModal"
    class="modal hidden"
    role="dialog"
    aria-modal="true"
    aria-labelledby="inventoryModalTitle"
  >
    <div class="modal-backdrop" data-close-modal="inventory"></div>
    <div class="modal-dialog ability-modal">
      <header class="modal-header">
        <h2 id="inventoryModalTitle">Nuevo item</h2>
        <button type="button" class="icon-button close" id="closeInventoryModal" aria-label="Cerrar">
          <svg class="icon icon-xmark" aria-hidden="true" focusable="false">
            <use href="#icon-xmark" xlink:href="#icon-xmark"></use>
          </svg>
        </button>
      </header>
      <form id="inventoryForm" class="inventory-form" autocomplete="off">
        <div class="form-grid">
          <label class="form-field stacked">
            Título
            <input id="inventoryTitle" name="title" type="text" required />
          </label>
          <label class="form-field stacked">
            Descripción
            <textarea id="inventoryDescription" name="description" rows="4"></textarea>
          </label>
        </div>
        <div class="inventory-image-field">
          <div class="inventory-image-frame">
            <img id="inventoryPreview" alt="Vista previa del item" class="hidden" />
            <div class="inventory-image-placeholder" id="inventoryPreviewPlaceholder">
              <i class="fa-solid fa-circle" aria-hidden="true"></i>
            </div>
          </div>
          <div class="inventory-image-actions">
            <label class="btn primary file-btn">
              <svg class="icon icon-upload" aria-hidden="true" focusable="false">
                <use href="#icon-upload" xlink:href="#icon-upload"></use>
              </svg>
              Subir PNG
              <input id="inventoryImage" type="file" accept="image/png" hidden />
            </label>
            <button type="button" class="btn secondary" id="clearInventoryImage">Quitar imagen</button>
          </div>
        </div>
        <footer class="form-actions">
          <button type="button" class="btn secondary" id="cancelInventory">Cancelar</button>
          <button type="submit" class="btn primary">Guardar</button>
        </footer>
      </form>
    </div>
  </div>

  <script>
    (function applyDefaultPortraits() {
      const basePlaceholder = window.DEFAULT_PORTRAIT;
      const version = window.APP_VERSION;
      const hasPlaceholder = typeof basePlaceholder === 'string' && basePlaceholder.length > 0;
      if (!hasPlaceholder) {
        return;
      }
      const isDataUri = hasPlaceholder && basePlaceholder.startsWith('data:');
      const placeholder =
        hasPlaceholder && !isDataUri && version
          ? `${basePlaceholder}${basePlaceholder.includes('?') ? '&' : '?'}v=${version}`
          : basePlaceholder;

      document.querySelectorAll('[data-default-portrait]').forEach((img) => {
        if (img.dataset.portraitFallbackBound !== 'true') {
          img.dataset.portraitFallbackBound = 'true';
          img.addEventListener('error', () => {
            if (img.dataset.usingPortraitFallback === 'true') {
              return;
            }
            img.dataset.usingPortraitFallback = 'true';
            img.setAttribute('src', placeholder);
          });
        }

        if (!img.getAttribute('src')) {
          img.dataset.usingPortraitFallback = 'false';
          img.setAttribute('src', placeholder);
        }
      });
    })();
  </script>

  <script>
    (function displayAppVersion() {
      const badge = document.querySelector('[data-app-version]');
      if (!badge) return;
      const label = window.APP_VERSION_LABEL || window.APP_VERSION;
      if (!label) {
        badge.remove();
        return;
      }
      const text = label.toString().trim();
      if (!text) {
        badge.remove();
        return;
      }
      badge.textContent = text;
      badge.setAttribute('title', `Versión ${text}`);
    })();
  </script>

  <script>
    (function loadAppScript() {
      const script = document.createElement('script');
      script.src = `script.js?v=${window.APP_VERSION}`;
      document.body.appendChild(script);
    })();
  </script>
</body>
</html>
